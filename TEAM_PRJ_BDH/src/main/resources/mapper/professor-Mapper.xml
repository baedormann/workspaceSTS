<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="professorMapper">

	<resultMap type="com.kh.teamprj.vo.LecVO" id="lec">
		<id 	column="LEC_NO" 		property="lecNo"/>
		<result column="LEC_NAME" 		property="lecName"/>
		<result column="LEC_SCORE" 		property="lecScore"/>
		<result column="COLL_NO" 		property="collNo"/>
		<result column="COLL_NAME" 		property="collName"/>
		<result column="DEPT_NO" 		property="deptNo"/>
		<result column="DEPT_NAME" 		property="deptName"/>
		<result column="LEC_PR" 		property="lecPr"/>
		<result column="CREATE_DATE" 	property="createDate"/>
		<result column="MAX_NUM" 		property="maxNum"/>
		<result column="NOW_NUM" 		property="nowNum"/>
		<result column="LEC_DATE" 		property="lecDate"/>
		<result column="LEC_MEMO" 		property="lecMemo"/>
	</resultMap>
	<resultMap type="com.kh.teamprj.vo.StuScoreVO" id="score">
		<result column="LEC_NO" 		property="lecNo"/>
		<result column="LEC_NAME" 		property="grade"/>
		<result column="LEC_NAME" 		property="stuNo"/>
		<result column="LEC_NAME" 		property="semNo"/>
	</resultMap>
	<resultMap type="com.kh.teamprj.vo.CollVO" id="coll">
		<id 	column="COLL_NO" 	property="collNo"/>
		<result column="COLL_NAME" 	property="collName"/>
	</resultMap>
	<resultMap type="com.kh.teamprj.vo.DeptVO" id="dept">
		<id 	column="DEPT_NO" 	property="deptNo"/>
		<result column="DEPT_NAME" 	property="deptName"/>
		<result column="COLL_NO" 	property="collNo"/>
	</resultMap>
	<resultMap type="com.kh.teamprj.vo.SemesterVO" id="sem">
		<id 	column="SEM_NO" 	property="semNo"/>
		<result column="YEAR" 		property="year"/>
		<result column="SEMESTER" 	property="semester"/>
		<result column="SEM_NAME" 	property="semName"/>
		
	</resultMap>
	<resultMap type="com.kh.teamprj.vo.Stu1VO" id="stu">
		<id 	column="STU_NO" 		property="stuNo"/>
		<result column="LEC_NO" 		property="lecNo"/>
		<result column="SEM_NO" 		property="semNo"/>
		<result column="MEM_NO" 		property="memNo"/>
		<result column="MEM_NAME" 		property="memName"/>
		<result column="DEPT_NO" 		property="deptNo"/>
		<result column="DEPT_NAME" 		property="deptName"/>
		<result column="DOUBLE_NO" 		property="doubleNo"/>
		<result column="STU_STATUS" 	property="stuStatus"/>
		<result column="COLL_NO" 		property="collNo"/>
		<result column="COLL_NAME" 		property="collName"/>
		<result column="STU_YEAR" 		property="stuYear"/>
		<result column="STU_SEM" 		property="stuSem"/>
		<result column="GRADE" 			property="grade"/>
		<result column="MEM_PHONE" 		property="memPhone"/>
		<result column="MEM_EMAIL" 		property="memEmail"/>
	</resultMap>
	
	
	<!-- 강의 등록 -->
	<insert id="insertLec">
		INSERT INTO LEC (
		    LEC_NO
		    , LEC_NAME
		    , LEC_SCORE
		    , COLL_NO
		    , DEPT_NO
		    , LEC_PR
		    , MAX_NUM
		    , LEC_DATE
		    <if test="lecMemo != null and !lecMemo.equals('')">
		    , LEC_MEMO
		    </if>
		) VALUES (
		    (SELECT 'LEC_'||(NVL(MAX(TO_NUMBER(SUBSTR(LEC_NO, 4))), 0) + 1) FROM LEC)
		    , #{lecName}
		    , #{lecScore}
		    , #{collNo}
		    , #{deptNo}
		    , #{lecPr}
		    , #{maxNum}
		    , #{lecDate}
		    <if test="lecMemo != null and !lecMemo.equals('')">
		    , #{lecMemo}
		    </if>
		)
	</insert>
	
	<!-- 성적 등록 -->
	<insert id="insertGrade">
		INSERT INTO STU_SCORE(
		    LEC_NO
		    , GRADE
		    , STU_NO
		    , SEM_NO
		    , SCORE
		) VALUES (
		    #{lecNo}
		    , #{grade}
		    , #{stuNo}
		    , #{semNo}
		    <if test="!grade.equals('F')">
		    , (SELECT LEC_SCORE FROM LEC WHERE LEC_SCORE = SCORE)
		    </if>
		    
		)
	</insert>
	
	<!-- 강의 목록 -->
	<select id="selectLecList" resultMap="lec">
		SELECT LEC_NO
		    , LEC_NAME
		    , LEC_SCORE
		    , COLL_NAME
		    , DEPT_NAME
		    , CREATE_DATE
		    , LEC_PR
		    , MAX_NUM
		    , NOW_NUM
		    , LEC_DATE
		    , LEC_MEMO
		FROM LEC L, COLLEGE C, DEPT D
		WHERE L.COLL_NO = C.COLL_NO
		AND L.DEPT_NO = D.DEPT_NO
		AND LEC_PR = #{lecPr}
	</select>
	
	<!-- 내강의를 듣고있는 학생 조회 --> <!-- 수강신청 기능이 만들어지면 만들어야할거같습니다 테이블 수정도 필요? -->
	<select id="selectLecStu" resultMap="stu">
		SELECT S.STU_NO
		    , STU_YEAR
		    , STU_STATUS
		    , DEPT_NAME
		    , COLL_NAME
		    , MEM_NAME
		    , R.GRADE
		FROM STU_CLASS C, STU_SCORE R, STUDENT S, MEMBER M, DEPT D, COLLEGE E
		WHERE C.LEC_NO = R.LEC_NO
		AND C.STU_NO = S.STU_NO
		AND S.MEM_NO = M.MEM_NO
		AND D.DEPT_NO = S.DEPT_NO
		AND S.COLL_NO = E.COLL_NO
		<if test="lecNo != null and !lecNo.equals('')">
		AND C.LEC_NO = #{lecNo}
		</if>
	</select>
	
	<!-- 단과대 정보 조회 -->
	<select id="selectCollege" resultMap="coll">
		SELECT COLL_NO
		    , COLL_NAME
		FROM COLLEGE
	</select>
	
	<!-- 학과 조회 -->
	<select id="selectDeptList" resultMap="dept">
		SELECT DEPT_NO
			, DEPT_NAME
		FROM DEPT
		WHERE COLL_NO = #{collNo}
	</select>
	
	<!-- 학기정보 조회 -->
	<select id="selectSemList" resultMap="sem">
		SELECT SEM_NO
			, YEAR
			, SEMESTER
			, SEM_NAME
		FROM SEMESTER
	</select>
	
	<!-- 학생조회 -->
	<select id="selectStuList" resultMap="stu">
	SELECT STU_NO
	    , MEM_NAME
	    , MEM_EMAIL
	    , MEM_PHONE
	    , STU_STATUS
	    , DEPT_NAME
	    , COLL_NAME
	FROM STUDENT S, MEMBER M, COLLEGE C, DEPT D
	WHERE S.MEM_NO = M.MEM_NO
	AND S.COLL_NO = C.COLL_NO
	AND S.DEPT_NO = D.DEPT_NO
	</select>
	
	
</mapper>













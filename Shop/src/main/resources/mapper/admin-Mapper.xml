<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 모든 SQL문을 item태그 안에 작성 -->
<mapper namespace="adminMapper">
	<resultMap type="com.kh.shop.vo.MenuVO" id="menu">
		<id column="MENU_CODE" property="menuCode"/>
		<result column="MENU_NAME" property="menuName"/>
		<result column="MENU_URI" property="menuUri"/>
	</resultMap>

	<resultMap type="com.kh.shop.vo.SubMenuVO" id="subMenu">
		<id column="SUB_MENU_CODE" property="subMenuCode"/>
		<result column="SUB_MENU_NAME" property="subMenuName"/>
		<result column="MENU_CODE" property="menuCode"/>
		<result column="MENU_URI" property="menuUri"/>
	</resultMap>

	<resultMap type="com.kh.shop.vo.CategoryVO" id="category">
		<id column="CATE_CODE" 		property="cateCode"/>
		<result column="CATE_NAME" 	property="cateName"/>
	</resultMap>
	
	<!-- 메뉴 조회 -->
	<select id="selectMenuList" resultMap="menu">
		SELECT MENU_CODE
			, MENU_NAME
			, MENU_URI
		FROM ADMIN_MENU
	</select>
	
	<!-- 서브메뉴 조회 -->
	<select id="selectSubMenuList" resultMap="subMenu">
		SELECT SUB_MENU_CODE
			, SUB_MENU_NAME
			, MENU_CODE
			, MENU_URI
		FROM SUB_MENU
		WHERE MENU_CODE = #{menuCode}
	</select>
	
	<insert id="insertImages">
		INSERT INTO ITEM_IMAGE (
			IMG_CODE
			, ORIGIN_IMG_NAME
			, ATTACHED_IMG_NAME
			, IS_MAIN
			, ITEM_CODE
		)
		<foreach collection="imgList" item="img" separator="UNION ALL">
			SELECT #{img.imgCode}
				, #{img.originImgName}
				, #{img.attachedImgName}
				, #{img.isMain}
				, #{img.itemCode}
			FROM DUAL
		</foreach>
	</insert>
	<!-- 카테고리 전체 조회 -->
	<!-- <select id="selectCategoryList" resultMap="category">
		SELECT CATE_CODE
			, CATE_NAME
		FROM ITEM_CATEGORY
	</select> -->
	
	<!-- 상품 등록 -->
	<insert id="insertItem">
		INSERT INTO SHOP_ITEM (
			ITEM_CODE
			, ITEM_NAME
			, ITEM_PRICE
			, ITEM_DETAIL
			, CATE_CODE
		) VALUES (
			#{itemCode}
			, #{itemName}
			, #{itemPrice}
			, #{itemDetail}
			, #{cateCode}
		)
	</insert>
	<select id="selectNextItemCode" resultType="String">
		SELECT 'ITEM_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(ITEM_CODE, 6, 3))), 0) + 1, 3, 0)
		FROM SHOP_ITEM
	</select>
	<select id="selectNextImgCode" resultType="int">
		SELECT NVL(MAX(IMG_CODE), 0) + 1
		FROM ITEM_IMAGE
	</select>
</mapper>